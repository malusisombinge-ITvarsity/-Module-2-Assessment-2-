define(["Magento_Customer/js/customer-data","Magento_Ui/js/lib/core/class","underscore"],(function(t,e,r){"use strict";return e.extend({customerDataKey:"google-tag-manager-product-info",initialize:function(){this._super(),t.get(this.customerDataKey).subscribe(this.onDataChange,this)},onDataChange:function(e){if(!r.isEmpty(e)&&!r.isEmpty(e.data)&&!r.isEmpty(e.data.products)){var a=e.data;if(a.products.added_item_data)this.reportAddedProducts(a.products.added_item_data,a.currencyCode);if(a.products.removed_item_data)this.reportRemovedProducts(a.products.removed_item_data,a.currencyCode);t.set(this.customerDataKey,{})}},reportAddedProducts:function(t,e){this.pushEvent("addToCart","add",t,e)},reportRemovedProducts:function(t,e){this.pushEvent("removeFromCart","remove",t,e)},pushEvent:function(t,e,r,a){var d={event:t,ecommerce:{currencyCode:a}};d.ecommerce[e]={products:r},window.dataLayer=window.dataLayer||[],window.dataLayer.push(d)}})}));